<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Healthcare Market Intelligence Report System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f7;
      color: #111827;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    header {
      margin-bottom: 1.5rem;
      text-align: center;
    }

    header h1 {
      margin: 0 0 0.3rem;
      font-size: 2rem;
    }

    header p {
      margin: 0.1rem 0;
      color: #4b5563;
      font-size: 0.9rem;
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: 0.7rem 1.6rem;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      transition: background 0.15s, transform 0.08s, box-shadow 0.15s;
    }

    .tab-btn:hover {
      background: #e5e7eb;
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }

    .tab-btn.active {
      background: #2563eb;
      border-color: #2563eb;
      color: white;
      box-shadow: 0 4px 12px rgba(37,99,235,0.45);
    }

    .card {
      background: #ffffff;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 1.25rem 1.5rem 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card h2 {
      margin-top: 0;
    }

    .search-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .field {
      display: flex;
      flex-direction: column;
      flex: 1 1 160px;
      min-width: 150px;
    }

    .field label {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
      color: #4b5563;
    }

    input[type="text"], select {
      padding: 0.4rem 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
      background: #f9fafb;
    }

    input[type="text"]:focus, select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.4);
    }

    .filters-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .results-info {
      font-size: 0.85rem;
      color: #6b7280;
    }

    .btn-small {
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .btn-small:hover:not(:disabled) {
      background: #e5e7eb;
    }

    .btn-small:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .btn-clear {
      border-color: #f97316;
      color: #c2410c;
    }

    .btn-export {
      border-color: #16a34a;
      color: #166534;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      background: #ffffff;
      border-radius: 0.75rem;
      overflow: auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    thead {
      background: #e5e7eb;
    }

    th, td {
      padding: 0.45rem 0.6rem;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }

    th {
      font-weight: 600;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    .no-results {
      padding: 0.75rem;
      text-align: center;
      font-size: 0.9rem;
      color: #6b7280;
    }

    .pagination {
      margin-top: 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: #6b7280;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .pagination-controls {
      display: flex;
      gap: 0.4rem;
      align-items: center;
    }

    #section-dashboard, #section-search {
      display: none;
    }

    #section-dashboard.active, #section-search.active {
      display: block;
    }

    footer {
      text-align: center;
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 1rem;
    }

    @media (max-width: 640px) {
      table {
        font-size: 0.78rem;
      }
      th, td {
        padding: 0.35rem 0.45rem;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Healthcare Market Intelligence Report System</h1>
      <p>Healthcare Dashboard &amp; Data Warehouse Search</p>
      <p style="font-size:0.8rem; color:#9ca3af;">By Xuanzhong Chen</p>
    </header>

    <nav>
      <button class="tab-btn active" data-target="section-dashboard">Dashboard</button>
      <button class="tab-btn" data-target="section-search">Data Warehouse</button>
    </nav>

    <!-- DASHBOARD SECTION -->
    <section id="section-dashboard" class="card active">
      <h2>Tableau Story Dashboard</h2>
      <p style="font-size:0.9rem; color:#4b5563;">
        Interactive Tableau story embedded from Tableau Public.
      </p>

      <div style="margin-top:0.75rem;">
        <div class='tableauPlaceholder' id='viz1764225326698' style='position: relative'>
          <noscript>
            <a href='#'>
              <img alt='Story 1 ' src='https://public.tableau.com/static/images/ta/tableaufinished/Story1/1_rss.png' style='border: none' />
            </a>
          </noscript>
          <object class='tableauViz' style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
            <param name='embed_code_version' value='3' />
            <param name='site_root' value='' />
            <param name='name' value='tableaufinished/Story1' />
            <param name='tabs' value='no' />
            <param name='toolbar' value='yes' />
            <param name='static_image' value='https://public.tableau.com/static/images/ta/tableaufinished/Story1/1.png' />
            <param name='animate_transition' value='yes' />
            <param name='display_static_image' value='yes' />
            <param name='display_spinner' value='yes' />
            <param name='display_overlay' value='yes' />
            <param name='display_count' value='yes' />
            <param name='language' value='en-US' />
          </object>
        </div>
        <script type='text/javascript'>
          var divElement2 = document.getElementById('viz1764225326698');
          var vizElement2 = divElement2.getElementsByTagName('object')[0];
          vizElement2.style.width='100%';
          vizElement2.style.height=(divElement2.offsetWidth*0.75)+'px';
          var scriptElement2 = document.createElement('script');
          scriptElement2.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement2.parentNode.insertBefore(scriptElement2, vizElement2);
        </script>
      </div>
    </section>

    <!-- SEARCH SECTION -->
    <section id="section-search" class="card">
      <h2>Provider Data Warehouse Search</h2>
      <p style="font-size:0.9rem; color:#4b5563;">
        Filter providers by <strong>Cred</strong>, <strong>Full Name</strong>, <strong>Pri_spec</strong>, <strong>Facility Name</strong>, and <strong>State</strong>. All columns from <code>providers.json</code> are displayed.
      </p>

      <!-- Filters -->
      <div class="search-row">
        <div class="field">
          <label for="fullNameSearch">Full Name</label>
          <input type="text" id="fullNameSearch" placeholder="e.g., Smith, John">
        </div>
        <div class="field">
          <label for="credFilter">Cred</label>
          <select id="credFilter">
            <option value="">All credentials</option>
          </select>
        </div>
      </div>

      <div class="search-row">
        <div class="field">
          <label for="specFilter">Pri_spec</label>
          <select id="specFilter">
            <option value="">All specialties</option>
          </select>
        </div>
        <div class="field">
          <label for="facilitySearch">Facility Name</label>
          <input type="text" id="facilitySearch" placeholder="e.g., Hospital name">
        </div>
        <div class="field">
          <label for="stateFilter">State</label>
          <select id="stateFilter">
            <option value="">All states</option>
          </select>
        </div>
      </div>

      <div class="filters-footer">
        <div class="results-info" id="resultsInfo">
          Loading data…
        </div>
        <div style="display:flex; gap:0.4rem; flex-wrap:wrap;">
          <button class="btn-small btn-clear" id="clearFilters">Clear filters</button>
          <button class="btn-small btn-export" id="exportCsvBtn" disabled>Export filtered to CSV</button>
        </div>
      </div>

      <!-- Results table -->
      <div style="overflow-x:auto;">
        <table id="resultsTable">
          <thead>
            <tr id="headerRow">
              <th>Loading…</th>
            </tr>
          </thead>
          <tbody id="resultsBody">
            <tr><td class="no-results">Loading…</td></tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" id="pagination">
        <div id="pageInfo"></div>
        <div class="pagination-controls">
          <button class="btn-small" id="prevPage">Previous</button>
          <button class="btn-small" id="nextPage">Next</button>
        </div>
      </div>
    </section>

    <footer>
      Healthcare Market Intelligence Report System · Tableau + Online Data Warehouse Search
    </footer>
  </div>

  <!-- Tab switching -->
  <script>
    const tabButtons = document.querySelectorAll('.tab-btn');
    const sections = {
      'section-dashboard': document.getElementById('section-dashboard'),
      'section-search': document.getElementById('section-search')
    };

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-target');

        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        Object.keys(sections).forEach(id => {
          sections[id].classList.toggle('active', id === target);
        });
      });
    });
  </script>

  <!-- Data warehouse search JS -->
  <script>
    const PAGE_SIZE = 50;

    let allData = [];
    let filteredData = [];
    let columns = [];
    let currentPage = 1;

    const fullNameInput = document.getElementById('fullNameSearch');
    const credFilter = document.getElementById('credFilter');
    const facilityInput = document.getElementById('facilitySearch');
    const stateFilter = document.getElementById('stateFilter');
    const specFilter = document.getElementById('specFilter');
    const clearFiltersBtn = document.getElementById('clearFilters');
    const exportCsvBtn = document.getElementById('exportCsvBtn');

    const headerRow = document.getElementById('headerRow');
    const resultsBody = document.getElementById('resultsBody');
    const resultsInfo = document.getElementById('resultsInfo');
    const pageInfo = document.getElementById('pageInfo');
    const prevPageBtn = document.getElementById('prevPage');
    const nextPageBtn = document.getElementById('nextPage');

    fetch('providers.json')
      .then(resp => resp.json())
      .then(data => {
        allData = data;
        if (allData.length > 0) {
          columns = Object.keys(allData[0]);  // Use all columns
          buildTableHeader();
          buildFilters();
          applyFilters();
        } else {
          resultsInfo.textContent = "No data found in providers.json.";
        }
      })
      .catch(err => {
        console.error(err);
        resultsInfo.textContent = "Error loading data. Make sure providers.json is in the same folder as index.html.";
      });

    function buildTableHeader() {
      headerRow.innerHTML = '';
      columns.forEach(col => {
        const th = document.createElement('th');
        th.textContent = col;
        headerRow.appendChild(th);
      });
    }

    function buildFilters() {
      // Unique Cred
      const creds = Array.from(new Set(allData.map(r => r.Cred || r["Cred"]).filter(Boolean))).sort();
      creds.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        credFilter.appendChild(opt);
      });

      // Unique states
      const states = Array.from(new Set(allData.map(r => r["State"] || r.State).filter(Boolean))).sort();
      states.forEach(st => {
        const opt = document.createElement('option');
        opt.value = st;
        opt.textContent = st;
        stateFilter.appendChild(opt);
      });

      // Unique specialties
      const specs = Array.from(new Set(allData.map(r => r["Pri_spec"] || r.Pri_spec).filter(Boolean))).sort();
      specs.forEach(sp => {
        const opt = document.createElement('option');
        opt.value = sp;
        opt.textContent = sp;
        specFilter.appendChild(opt);
      });
    }

    function applyFilters() {
      const nameQ = (fullNameInput.value || '').toLowerCase().trim();
      const credVal = credFilter.value;
      const facilityQ = (facilityInput.value || '').toLowerCase().trim();
      const st = stateFilter.value;
      const sp = specFilter.value;

      filteredData = allData.filter(row => {
        let ok = true;

        const fullName = (row["Full Name"] || '').toString().toLowerCase();
        const cred = (row["Cred"] || row.Cred || '').toString();
        const facility = (row["Facility Name"] || '').toString().toLowerCase();
        const stateVal = row["State"] || row.State || '';
        const priSpec = row["Pri_spec"] || row.Pri_spec || '';

        if (nameQ && !fullName.includes(nameQ)) ok = false;
        if (credVal && cred !== credVal) ok = false;
        if (facilityQ && !facility.includes(facilityQ)) ok = false;
        if (st && stateVal !== st) ok = false;
        if (sp && priSpec !== sp) ok = false;

        return ok;
      });

      currentPage = 1;
      renderTable();
      exportCsvBtn.disabled = filteredData.length === 0;
    }

    function renderTable() {
      resultsBody.innerHTML = '';

      if (!filteredData.length) {
        const noRow = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = Math.max(columns.length, 1);
        td.className = 'no-results';
        td.textContent = 'No matching records.';
        noRow.appendChild(td);
        resultsBody.appendChild(noRow);

        resultsInfo.textContent = '0 results.';
        pageInfo.textContent = '';
        prevPageBtn.disabled = true;
        nextPageBtn.disabled = true;
        return;
      }

      const total = filteredData.length;
      const totalPages = Math.ceil(total / PAGE_SIZE);
      if (currentPage > totalPages) currentPage = totalPages;

      const start = (currentPage - 1) * PAGE_SIZE;
      const end = Math.min(start + PAGE_SIZE, total);
      const pageSlice = filteredData.slice(start, end);

      pageSlice.forEach(row => {
        const tr = document.createElement('tr');
        columns.forEach(col => {
          const td = document.createElement('td');
          td.textContent = (row[col] !== undefined && row[col] !== null) ? row[col] : '';
          tr.appendChild(td);
        });
        resultsBody.appendChild(tr);
      });

      resultsInfo.textContent = `${total} result(s) — showing ${start + 1} to ${end}.`;
      pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage === totalPages;
    }

    function exportFilteredToCsv() {
      if (!filteredData.length || !columns.length) return;

      function esc(val) {
        const v = (val ?? "").toString();
        if (/[",\n]/.test(v)) {
          return '"' + v.replace(/"/g, '""') + '"';
        }
        return v;
      }

      const lines = [];
      lines.push(columns.join(","));

      filteredData.forEach(row => {
        const rowArr = columns.map(col => esc(row[col]));
        lines.push(rowArr.join(","));
      });

      const csvContent = lines.join("\r\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "filtered_providers_full_columns.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Events
    fullNameInput.addEventListener('input', applyFilters);
    credFilter.addEventListener('change', applyFilters);
    facilityInput.addEventListener('input', applyFilters);
    stateFilter.addEventListener('change', applyFilters);
    specFilter.addEventListener('change', applyFilters);

    clearFiltersBtn.addEventListener('click', () => {
      fullNameInput.value = '';
      credFilter.value = '';
      facilityInput.value = '';
      stateFilter.value = '';
      specFilter.value = '';
      applyFilters();
    });

    prevPageBtn.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    });

    nextPageBtn.addEventListener('click', () => {
      const totalPages = Math.ceil(filteredData.length / PAGE_SIZE);
      if (currentPage < totalPages) {
        currentPage++;
        renderTable();
      }
    });

    exportCsvBtn.addEventListener('click', exportFilteredToCsv);
  </script>
</body>
</html>
