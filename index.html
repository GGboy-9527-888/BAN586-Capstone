<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Healthcare Market Intelligence Report System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      color: #222;
    }

    header {
      background: #004b8d;
      color: #fff;
      padding: 20px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }

    main {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .nav-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .nav-buttons a {
      display: inline-block;
      padding: 16px 32px;
      font-size: 1.1rem;
      text-decoration: none;
      background: #007bff;
      color: #fff;
      border-radius: 999px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    .nav-buttons a:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0,0,0,0.2);
      background: #005fcc;
    }

    section {
      background: #fff;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    section h2 {
      margin-top: 0;
      font-size: 1.4rem;
      border-bottom: 2px solid #eee;
      padding-bottom: 8px;
      margin-bottom: 16px;
    }

    /* Filters */
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 15px;
    }

    .filters label {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
    }

    .filters select {
      min-width: 140px;
      padding: 4px 6px;
      margin-top: 2px;
    }

    .filters button {
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
    }

    #clearFiltersBtn {
      background: #e0e0e0;
    }

    #exportCsvBtn {
      background: #28a745;
      color: #fff;
    }

    /* Table */
    .table-wrapper {
      max-height: 500px;
      overflow: auto;
      border: 1px solid #ddd;
      border-radius: 6px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.85rem;
    }

    thead {
      position: sticky;
      top: 0;
      background: #f0f0f0;
      z-index: 1;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 6px 8px;
      text-align: left;
      white-space: nowrap;
    }

    tr:nth-child(even) {
      background: #fafafa;
    }

    .error-message {
      color: #c00;
      margin-top: 10px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Healthcare Market Intelligence Report System</h1>
    <div>By Xuanzhong Chen</div>
  </header>

  <main>
    <div class="nav-buttons">
      <a href="#dashboard">Dashboard</a>
      <a href="#data-warehouse">Data Warehouse</a>
    </div>

    <!-- Dashboard section with Tableau embed placeholder -->
    <section id="dashboard">
      <h2>Dashboard</h2>
      <p>Tableau dashboard (paste your embed code below).</p>

      <!-- Paste your Tableau embed code between these comments -->
      <!-- Example placeholder -->
      <div class='tableauPlaceholder' id='vizDashboard' style='position: relative'>
        <noscript>
          <a href='#'>
            <img alt='Story 1' src='https://public.tableau.com/static/images/ta/tableaufinished/Story1/1_rss.png' style='border: none' />
          </a>
        </noscript>
        <object class='tableauViz' style='display:none;'>
          <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
          <param name='embed_code_version' value='3' />
          <param name='site_root' value='' />
          <param name='name' value='tableaufinished/Story1' />
          <param name='tabs' value='no' />
          <param name='toolbar' value='yes' />
        </object>
      </div>
      <script type='text/javascript'>
        (function() {
          var divElement = document.getElementById('vizDashboard');
          if (!divElement) return;
          var vizElement = divElement.getElementsByTagName('object')[0];
          if (!vizElement) return;
          vizElement.style.width = '100%';
          vizElement.style.height = (divElement.offsetWidth * 0.6) + 'px';
          var scriptElement = document.createElement('script');
          scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement.parentNode.insertBefore(scriptElement, vizElement);
        })();
      </script>
    </section>

    <!-- Data Warehouse / Doctor table section -->
    <section id="data-warehouse">
      <h2>Doctor Data Warehouse</h2>

      <div class="filters">
        <label>
          Cred:
          <select id="credFilter">
            <option value="">All</option>
          </select>
        </label>

        <label>
          Full Name:
          <select id="fullNameFilter">
            <option value="">All</option>
          </select>
        </label>

        <label>
          Pri_spec:
          <select id="priSpecFilter">
            <option value="">All</option>
          </select>
        </label>

        <label>
          Facility Name:
          <select id="facilityFilter">
            <option value="">All</option>
          </select>
        </label>

        <label>
          State:
          <select id="stateFilter">
            <option value="">All</option>
          </select>
        </label>

        <button id="clearFiltersBtn" type="button">Clear Filters</button>
        <button id="exportCsvBtn" type="button">Export Filtered to CSV</button>
      </div>

      <div id="dataError" class="error-message"></div>

      <div class="table-wrapper">
        <table id="resultsTable">
          <thead id="tableHead"></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    /**********************************************************
     * 1. YOUR DOCTOR DATA (INLINE)
     *    Replace this sample data with your real data.
     *    You can convert CSV to JSON using any online tool
     *    and paste the array here.
     **********************************************************/
    const allData = [
      /* EXAMPLE ROWS â€“ DELETE AFTER YOU ADD REAL DATA
      {
        "Cred": "MD",
        "Full Name": "John Doe",
        "Pri_spec": "Internal Medicine",
        "Facility Name": "Flagstaff Medical Center",
        "State": "AZ",
        "NPI": "1234567890",
        "City": "Flagstaff"
      },
      {
        "Cred": "DO",
        "Full Name": "Jane Smith",
        "Pri_spec": "Family Practice",
        "Facility Name": "Banner Health",
        "State": "AZ",
        "NPI": "9876543210",
        "City": "Phoenix"
      }
      */
    ];

    let filteredData = [];

    // Mapping for filter fields to column names in your data
    const columnMap = {
      cred: "Cred",
      fullName: "Full Name",
      priSpec: "Pri_spec",
      facility: "Facility Name",
      state: "State"
    };

    document.addEventListener("DOMContentLoaded", () => {
      try {
        if (!Array.isArray(allData) || allData.length === 0) {
          document.getElementById("dataError").textContent =
            "No data loaded yet. Please paste your doctor records into the 'allData' array in the script at the bottom of this file.";
          return;
        }

        filteredData = allData.slice();

        buildTableHeader(allData);
        populateAllDropdowns(allData);
        renderTable(filteredData);
        attachFilterListeners();
      } catch (err) {
        console.error("Error during initialization:", err);
        document.getElementById("dataError").textContent =
          "An error occurred while loading the data. Please check the console for details.";
      }
    });

    function buildTableHeader(data) {
      const thead = document.getElementById("tableHead");
      thead.innerHTML = "";

      if (!data.length) return;

      const headerRow = document.createElement("tr");
      const columns = Object.keys(data[0]);

      columns.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col;
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);
    }

    function populateAllDropdowns(data) {
      const uniqueValues = (columnKey) => {
        return [...new Set(
          data
            .map(row => row[columnKey])
            .filter(v => v !== null && v !== undefined && v !== "")
        )].sort();
      };

      fillSelect("credFilter", uniqueValues(columnMap.cred));
      fillSelect("fullNameFilter", uniqueValues(columnMap.fullName));
      fillSelect("priSpecFilter", uniqueValues(columnMap.priSpec));
      fillSelect("facilityFilter", uniqueValues(columnMap.facility));
      fillSelect("stateFilter", uniqueValues(columnMap.state));
    }

    function fillSelect(selectId, values) {
      const select = document.getElementById(selectId);
      if (!select) return;

      // keep first "All" option
      select.querySelectorAll("option:not(:first-child)").forEach(o => o.remove());

      values.forEach(value => {
        const opt = document.createElement("option");
        opt.value = value;
        opt.textContent = value;
        select.appendChild(opt);
      });
    }

    function attachFilterListeners() {
      ["credFilter", "fullNameFilter", "priSpecFilter", "facilityFilter", "stateFilter"]
        .forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            el.addEventListener("change", applyFilters);
          }
        });

      document.getElementById("clearFiltersBtn").addEventListener("click", clearFilters);
      document.getElementById("exportCsvBtn").addEventListener("click", exportFilteredToCsv);
    }

    function clearFilters() {
      ["credFilter", "fullNameFilter", "priSpecFilter", "facilityFilter", "stateFilter"]
        .forEach(id => {
          const el = document.getElementById(id);
          if (el) el.value = "";
        });

      filteredData = allData.slice();
      renderTable(filteredData);
    }

    function applyFilters() {
      const credVal = document.getElementById("credFilter").value;
      const fullNameVal = document.getElementById("fullNameFilter").value;
      const priSpecVal = document.getElementById("priSpecFilter").value;
      const facilityVal = document.getElementById("facilityFilter").value;
      const stateVal = document.getElementById("stateFilter").value;

      filteredData = allData.filter(row => {
        const matchCred     = !credVal     || row[columnMap.cred]     === credVal;
        const matchFullName = !fullNameVal || row[columnMap.fullName] === fullNameVal;
        const matchPriSpec  = !priSpecVal  || row[columnMap.priSpec]  === priSpecVal;
        const matchFacility = !facilityVal || row[columnMap.facility] === facilityVal;
        const matchState    = !stateVal    || row[columnMap.state]    === stateVal;

        return matchCred && matchFullName && matchPriSpec && matchFacility && matchState;
      });

      renderTable(filteredData);
    }

    function renderTable(data) {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";

      if (!data.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        const colCount = document.getElementById("tableHead").querySelectorAll("th").length || 1;
        td.colSpan = colCount;
        td.textContent = "No records match the selected filters.";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      const columns = Object.keys(data[0]);

      data.forEach(row => {
        const tr = document.createElement("tr");
        columns.forEach(col => {
          const td = document.createElement("td");
          const val = row[col];
          td.textContent = (val === null || val === undefined) ? "" : val;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function exportFilteredToCsv() {
      if (!filteredData.length) {
        alert("No data to export.");
        return;
      }

      const columns = Object.keys(filteredData[0]);
      const rows = [];

      // Header
      rows.push(columns.map(escapeCsvValue).join(","));

      // Data rows
      filteredData.forEach(row => {
        const rowArr = columns.map(col => {
          const val = row[col];
          return escapeCsvValue(val === null || val === undefined ? "" : String(val));
        });
        rows.push(rowArr.join(","));
      });

      const csvContent = rows.join("\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "filtered_doctors.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      URL.revokeObjectURL(url);
    }

    function escapeCsvValue(value) {
      if (value == null) return "";
      const needsQuotes = /[",\n]/.test(value);
      let escaped = value.replace(/"/g, '""');
      return needsQuotes ? `"${escaped}"` : escaped;
    }
  </script>
</body>
</html>
